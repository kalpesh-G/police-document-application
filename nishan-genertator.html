<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ગુજરાત પોલીસ દસ્તાવેજ જનરેટર - અરેસ્ટ રજિસ્ટર</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Gujarati:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/docx@8.0.0/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.0.0/build/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Noto Sans Gujarati', 'Shruti', 'Gautami', sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.5;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: row;
            background-color: #fff;
        }
        
        /* Header */
        .header {
            background-color: #1a237e;
            color: white;
            padding: 1.2rem;
            text-align: center;
            border-bottom: 4px solid #ff5722;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 0.4rem;
            font-weight: 700;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        /* Form Section */
        .form-section {
            flex: 1;
            padding: 1.2rem;
            background-color: white;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: #1a237e;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #bdbdbd;
            border-radius: 3px;
            font-size: 0.9rem;
            transition: border-color 0.3s;
            background-color: #fff;
        }
        
        .form-control:focus {
            border-color: #1a237e;
            outline: none;
            box-shadow: 0 0 0 2px rgba(26, 35, 126, 0.1);
        }
        
        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }
        
        .form-row {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 0.8rem;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .section-title {
            background-color: #e8eaf6;
            padding: 0.6rem;
            margin: 1.2rem 0 0.8rem;
            border-left: 4px solid #1a237e;
            font-weight: 700;
            color: #1a237e;
            font-size: 0.95rem;
        }
        
        /* Dropdown with typing */
        .dropdown-container {
            position: relative;
        }
        
        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-top: none;
            max-height: 180px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .dropdown-option {
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .dropdown-option:hover {
            background-color: #f0f0f0;
        }
        
        /* Preview Section */
        .preview-section {
            flex: 1.3;
            padding: 1.2rem;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        
        .preview-container {
            flex: 1;
            background-color: white;
            border: 1px solid #bdbdbd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 1.2rem;
            overflow-y: auto;
            margin-bottom: 1.2rem;
        }
        
        /* Document Template - Matching the image */
        .document-template {
            width: 100%;
            font-size: 11px;
            line-height: 1.3;
            color: #000;
            font-family: 'Noto Sans Gujarati', 'Shruti', 'Gautami', sans-serif;
        }
        
        .document-header {
            text-align: center;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            border-bottom: none;
        }
        
        .document-header h2 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 0.4rem;
            text-decoration: none;
        }
        
        .document-header p {
            font-size: 12px;
            margin-bottom: 0.2rem;
        }
        
        /* Table styling to match the image exactly */
        .document-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            font-size: 10px;
            table-layout: fixed;
        }
        
        .document-table th {
            border: 1px solid #000;
            padding: 3px 2px;
            text-align: center;
            font-weight: 700;
            background-color: #ffffff;
            vertical-align: middle;
            font-size: 10px;
            line-height: 1.2;
        }
        
        .document-table td {
            border: 1px solid #000;
            padding: 3px 2px;
            vertical-align: top;
            word-wrap: break-word;
            font-size: 10px;
        }
        
        /* Column widths matching the image */
        .document-table th:nth-child(1), 
        .document-table td:nth-child(1) { width: 4%; } /* અ નં */
        .document-table th:nth-child(2), 
        .document-table td:nth-child(2) { width: 10%; } /* ગુન્હા રજી. નંબર */
        .document-table th:nth-child(3), 
        .document-table td:nth-child(3) { width: 12%; } /* પકડેલા માણસનું નામ */
        .document-table th:nth-child(4), 
        .document-table td:nth-child(4) { width: 10%; } /* રહેવાનુ હેકાણું */
        .document-table th:nth-child(5), 
        .document-table td:nth-child(5) { width: 8%; } /* જાતી અને ધંધો */
        .document-table th:nth-child(6), 
        .document-table td:nth-child(6) { width: 8%; } /* ગુન્હો તહોમત */
        .document-table th:nth-child(7), 
        .document-table td:nth-child(7) { width: 10%; } /* શરીર પરની નીશાનીઓ */
        .document-table th:nth-child(8), 
        .document-table td:nth-child(8) { width: 8%; } /* અટકાય તમાં છે કે જામીન ઉપર છે */
        .document-table th:nth-child(9), 
        .document-table td:nth-child(9) { width: 8%; } /* ગુન્હો સાબીત થયો કે નાસાબીત */
        .document-table th:nth-child(10), 
        .document-table td:nth-child(10) { width: 10%; } /* સગા સબંધીને જાણ */
        .document-table th:nth-child(11), 
        .document-table td:nth-child(11) { width: 12%; } /* જાણ કયાર્ની રીતે */
        .document-table th:nth-child(12), 
        .document-table td:nth-child(12) { width: 10%; } /* શેરો */
        
        .serial-number {
            text-align: center;
            font-weight: bold;
        }
        
        .table-footer {
            display: none;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            padding: 0.8rem;
            background-color: white;
            border-top: 1px solid #ddd;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 3px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.3s;
            min-width: 160px;
        }
        
        .btn-pdf {
            background-color: #d32f2f;
            color: white;
        }
        
        .btn-pdf:hover {
            background-color: #b71c1c;
            transform: translateY(-2px);
        }
        
        .btn-docx {
            background-color: #2e7d32;
            color: white;
        }
        
        .btn-docx:hover {
            background-color: #1b5e20;
            transform: translateY(-2px);
        }
        
        .btn-reset {
            background-color: #616161;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #424242;
            transform: translateY(-2px);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .form-section, .preview-section {
                width: 100%;
            }
            
            .form-section {
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .document-table {
                font-size: 10px;
            }
            
            .document-table th,
            .document-table td {
                padding: 3px 2px;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .preview-container {
                padding: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .document-table {
                display: block;
                overflow-x: auto;
            }
        }
        
        /* Status indicators */
        .status-message {
            padding: 0.6rem;
            border-radius: 3px;
            margin-bottom: 0.8rem;
            display: none;
            font-size: 0.9rem;
        }
        
        .status-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .status-error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        /* Gujarati specific styling */
        .gujarati-text {
            font-family: 'Noto Sans Gujarati', 'Shruti', 'Gautami', sans-serif;
            font-size: 11px;
            line-height: 1.4;
        }
        
        .field-value {
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        
        .required::after {
            content: " *";
            color: #d32f2f;
        }
        
        /* Form field highlighting */
        .form-control:invalid {
            border-color: #d32f2f;
        }
        
        .form-control:valid {
            border-color: #4caf50;
        }
        
        /* Checkbox styling */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.3rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ગુજરાત પોલીસ - ચહેરાનિશાન પત્રક ફોર્મ જનરેટર</h1>
        <p>આરોપીની વિગતો ભરો અને પોલીસ ચહેરાનિશાન પત્રક ફોર્મ જનરેટ કરો</p>
    </div>
    
    <div class="container">
        <div class="form-section">
            <div class="status-message" id="statusMessage"></div>
            
            <h3 class="section-title">મૂળભૂત વિગતો</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="firNumber" class="required">ગુન્હા રજી. નંબર</label>
                    <input type="text" id="firNumber" class="form-control" placeholder="દા.ત. અમીરગઢ પો.સ્ટે ગુ. ર.નં. ૧૧૧૯/૨૦૨૫" required>
                </div>
                <div class="form-group">
                    <label for="year" class="required">વર્ષ</label>
                    <input type="text" id="year" class="form-control" placeholder="દા.ત. ૨૦૨૫" value="૨૦૨૫" required>
                </div>
            </div>
            
            <h3 class="section-title">આરોપી વિગતો</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="accusedName" class="required">પકડેલા માણસનું નામ</label>
                    <input type="text" id="accusedName" class="form-control" placeholder="દા.ત. કાન્તીભાઇ બાબુભાઇ જાતે ઘોરણા" required>
                </div>
                <div class="form-group">
                    <label for="surname" class="required">અટક (સરનેઈમ)</label>
                    <input type="text" id="surname" class="form-control" placeholder="દા.ત. ઘોરણા" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fatherName" class="required">પિતાનું નામ</label>
                    <input type="text" id="fatherName" class="form-control" placeholder="દા.ત. બાબુભાઇ" required>
                </div>
                <div class="form-group">
                    <label for="caste" class="required">જાતિ</label>
                    <input type="text" id="caste" class="form-control" placeholder="દા.ત. હિંદુ ઘોરણા" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="district" class="required">જિલ્લો</label>
                    <div class="dropdown-container">
                        <input type="text" id="district" class="form-control" placeholder="જિલ્લો પસંદ કરો અથવા લખો" required>
                        <div class="dropdown-options" id="districtOptions"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="taluka" class="required">તાલુકો</label>
                    <div class="dropdown-container">
                        <input type="text" id="taluka" class="form-control" placeholder="પ્રથમ જિલ્લો પસંદ કરો" required>
                        <div class="dropdown-options" id="talukaOptions"></div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="village" class="required">ગામ/શહેર</label>
                <input type="text" id="village" class="form-control" placeholder="દા.ત. વેરા" required>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="occupation" class="required">ધંધો</label>
                    <input type="text" id="occupation" class="form-control" placeholder="દા.ત. ખેડૂત" required>
                </div>
                <div class="form-group">
                    <label for="lawSection" class="required">ગુન્હો તહોમત (કલમ)</label>
                    <input type="text" id="lawSection" class="form-control" placeholder="દા.ત. BNS કલમ ૨૮૧ મુજબ" value="BNS કલમ ૨૮૧ મુજબ" required>
                </div>
            </div>
            
            <h3 class="section-title">શારીરિક વર્ણન અને અટકાયત</h3>
            
            <div class="form-group">
                <label for="physicalDescription" class="required">શારીર પરની નિશાનીઓ</label>
                <textarea id="physicalDescription" class="form-control" placeholder="દા.ત. શરીરે જોતા મધ્યમબાંધાના રંગે શ્યામ વણા જેના ડાબા ગાલ પર જુનુ વાગેલાનુ નિશાન છે ઉંચાઇ ૧૬૫ સે.મી." required>શરીરે જોતા મધ્યમબાંધાના રંગે શ્યામ વણા જેના ડાબા ગાલ પર જુનુ વાગેલાનુ નિશાન છે ઉંચાઇ ૧૬૫ સે.મી.</textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="uv" class="required">ઉ.વ. (વર્ષ)</label>
                    <input type="text" id="uv" class="form-control" placeholder="દા.ત. ૨૨" required>
                </div>
                <div class="form-group">
                    <label for="height" class="required">ઉંચાઇ (સે.મી.)</label>
                    <input type="text" id="height" class="form-control" placeholder="દા.ત. ૧૬૫" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="arrestStatus" class="required">અટકાયત સ્થિતિ</label>
                    <select id="arrestStatus" class="form-control" required>
                        <option value="અટક">અટક</option>
                        <option value="જામીન">જામીન</option>
                        <option value="રિમાન્ડ">રિમાન્ડ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="arrestDate" class="required">અટકાયત તારીખ</label>
                    <input type="date" id="arrestDate" class="form-control" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="crimeStatus" class="required">ગુન્હો સાબીત થયો/નાસાબીત થયો/છોડી મુક્યા</label>
                    <select id="crimeStatus" class="form-control" required>
                        <option value="-">-</option>
                        <option value="સાબીત થયો">સાબીત થયો</option>
                        <option value="નાસાબીત થયો">નાસાબીત થયો</option>
                        <option value="છોડી મુક્યા">છોડી મુક્યા</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="bailDate">જામીન તારીખ (જો લાગુ પડતું હોય)</label>
                    <input type="date" id="bailDate" class="form-control">
                </div>
            </div>
            
            <h3 class="section-title">સબંધી જાણ કરવા અને શેરો</h3>
            
            <div class="form-group">
                <label for="relativeInfo">આરોપીઓના સગા સબંધીને જાણ કરેલ હોય તો તેનુ નામ, સરનામું</label>
                <textarea id="relativeInfo" class="form-control" placeholder="સબંધીનું નામ અને સરનામું">-</textarea>
            </div>
            
            <div class="form-group">
                <label for="diaryEntry" class="required">દૈનિક સ્ટેશન ડાયરી એન્ટ્રી નંબર અને સમય</label>
                <input type="text" id="diaryEntry" class="form-control" placeholder="દા.ત. સ્ટે.ડા.એ.નં. ૫૦૦૩૨૫૦/૨૦૨૫ ક./તા. ૨૧/૧૨/૨૦૨૫" required>
            </div>
            
            <div class="form-group">
                <label for="remarks" class="required">શેરો (વિશેષ નોંધ)</label>
                <textarea id="remarks" class="form-control" placeholder="દા.ત. આજરોજ તા. ૨૧/૧૨/૨૦૨૫ ના ક. ૧/૫/૩૦ વાગે નામદાર સુપ્રીમ કોર્ટની ગાઇડલાઇન મુજબ નોટીસ આપી જામીન મુક્ત કરેલ છે." required>આજરોજ તા. ૨૧/૧૨/૨૦૨૫ ના ક. ૧/૫/૩૦ વાગે નામદાર સુપ્રીમ કોર્ટની ગાઇડલાઇન મુજબ નોટીસ આપી જામીન મુક્ત કરેલ છે.</textarea>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="officerName" class="required">અધિકારીનું નામ</label>
                    <input type="text" id="officerName" class="form-control" placeholder="અધિકારીનું પૂરું નામ" required>
                </div>
                
                <div class="form-group">
                    <label for="officerPost" class="required">અધિકારીનો હોદ્દો</label>
                    <input type="text" id="officerPost" class="form-control" placeholder="દા.ત. હેડ કોન્સ્ટેબલ" required>
                </div>
            </div>

            <div class="form-group">
                <label for="policeStation" class="required">પોલીસ સ્ટેશન</label>
                <input type="text" id="policeStation" class="form-control" placeholder="દા.ત. અમીરગઢ પોલીસ સ્ટેશન" required>
            </div>
        </div>
        
        <div class="preview-section">
            <h3 class="section-title">લાઈવ પ્રિવ્યુ - અરેસ્ટ રજિસ્ટર ફોર્મ</h3>
            
            <div class="preview-container">
                <div class="document-template" id="documentPreview">
                    </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-pdf" id="generatePdf">
                    <span>PDF જનરેટ કરો</span>
                </button>
                <button class="btn btn-docx" id="generateDocx">
                    <span>Word ડોક્યુમેન્ટ જનરેટ કરો</span>
                </button>
                <button class="btn btn-reset" id="resetForm">
                    <span>ફોર્મ રીસેટ કરો</span>
                </button>
            </div>
        </div>
    </div>

    <script src="gujarat-district-taluka-gu.js"></script>
    
    <script>
        // Reference the external gujaratTalukas data
        const gujaratData = gujaratTalukas;

        // English to Gujarati mapping for common terms
        const translationMap = {
            "amirgadh": "અમીરગઢ",
            "city": "શહેર",
            "town": "શહેર",
            "village": "ગામ"
        };

        // DOM Elements
        const formInputs = {
            firNumber: document.getElementById('firNumber'),
            year: document.getElementById('year'),
            accusedName: document.getElementById('accusedName'),
            surname: document.getElementById('surname'),
            fatherName: document.getElementById('fatherName'),
            caste: document.getElementById('caste'),
            district: document.getElementById('district'),
            taluka: document.getElementById('taluka'),
            village: document.getElementById('village'),
            occupation: document.getElementById('occupation'),
            lawSection: document.getElementById('lawSection'),
            physicalDescription: document.getElementById('physicalDescription'),
            uv: document.getElementById('uv'),
            height: document.getElementById('height'),
            arrestStatus: document.getElementById('arrestStatus'),
            arrestDate: document.getElementById('arrestDate'),
            crimeStatus: document.getElementById('crimeStatus'),
            bailDate: document.getElementById('bailDate'),
            relativeInfo: document.getElementById('relativeInfo'),
            diaryEntry: document.getElementById('diaryEntry'),
            remarks: document.getElementById('remarks'),
            officerName: document.getElementById('officerName'),
            officerPost: document.getElementById('officerPost'),
            policeStation: document.getElementById('policeStation')
        };

        const districtOptions = document.getElementById('districtOptions');
        const talukaOptions = document.getElementById('talukaOptions');
        const documentPreview = document.getElementById('documentPreview');
        const generatePdfBtn = document.getElementById('generatePdf');
        const generateDocxBtn = document.getElementById('generateDocx');
        const resetFormBtn = document.getElementById('resetForm');
        const statusMessage = document.getElementById('statusMessage');

        // State
        let selectedDistrict = null;
        let currentTalukas = [];
        let today = new Date().toISOString().split('T')[0];

        // Initialize form with local storage data or defaults
        function initializeForm() {
            document.getElementById('arrestDate').value = today;
            
            const rawData = localStorage.getItem('policeFormData');

            if (rawData) {
                try {
                    const data = JSON.parse(rawData);
                    
                    // Map stored data to form fields
                    formInputs.firNumber.value = data.crime_no || "અમીરગઢ પો.સ્ટે ગુ. ર.નં. ૧૧૧૯/૨૦૨૫";
                    formInputs.year.value = data.crime_year || "૨૦૨૫";
                    formInputs.accusedName.value = data.acc_name || "કાન્તીભાઇ";
                    formInputs.surname.value = data.acc_surname || "ઘોરણા";
                    formInputs.fatherName.value = data.acc_father || "બાબુભાઇ";
                    formInputs.caste.value = (data.acc_caste || "હિંદુ") + " " + (data.acc_subcaste || "");
                    
                    formInputs.district.value = data.perm_district || "બનાસકાંઠા";
                    formInputs.taluka.value = data.perm_taluka || "અમીરગઢ";
                    formInputs.village.value = data.perm_village || "વેરા";
                    
                    formInputs.occupation.value = data.occ_type || "ખેડૂત";
                    formInputs.lawSection.value = data.offence_section || "BNS કલમ ૨૮૧ મુજબ";
                    
                    // Construct physical description from multiple stored fields
                    let physDesc = `શરીરે જોતા ${data.phy_build || 'મધ્યમ'} બાંધાના, રંગે ${data.phy_complexion || 'શ્યામ'}`;
                    if(data.mark_1) physDesc += `, નિશાન ૧: ${data.mark_1}`;
                    if(data.mark_2) physDesc += `, નિશાન ૨: ${data.mark_2}`;
                    physDesc += `, ઉંચાઇ ${data.phy_height || '૧૬૫'} સે.મી.`;
                    
                    formInputs.physicalDescription.value = physDesc;
                    
                    formInputs.uv.value = data.acc_age || "૨૨";
                    formInputs.height.value = data.phy_height || "૧૬૫";
                    
                    formInputs.arrestStatus.value = "અટક";
                    formInputs.crimeStatus.value = data.crime_status || "-";
                    formInputs.relativeInfo.value = data.rel_name ? `${data.rel_name} (${data.rel_relation}), ${data.rel_address}` : "-";
                    
                    formInputs.diaryEntry.value = data.arrest_entry_no ? `સ્ટે.ડા.એ.નં. ${data.arrest_entry_no}` : "સ્ટે.ડા.એ.નં. ૫૦૦૩૨૫૦/૨૦૨૫";
                    formInputs.remarks.value = data.remarks || "આજરોજ નામદાર સુપ્રીમ કોર્ટની ગાઇડલાઇન મુજબ નોટીસ આપી જામીન મુક્ત કરેલ છે.";
                    
                    formInputs.officerName.value = data.io_name || "";
                    formInputs.officerPost.value = data.io_designation || "હેડ કોન્સ્ટેબલ";
                    formInputs.policeStation.value = data.case_ps || "અમીરગઢ પોલીસ સ્ટેશન";
                    
                    // Set district state
                    selectedDistrict = gujaratData.districts.find(d => d.district === formInputs.district.value);
                    currentTalukas = selectedDistrict ? selectedDistrict.talukas : [];

                    // Show success message
                    setTimeout(() => {
                        showStatus('સંગ્રહિત ડેટા સફળતાપૂર્વક લોડ થયો (Saved data loaded successfully).', 'success');
                    }, 500);

                } catch (e) {
                    console.error("Error parsing local storage", e);
                    setDefaultValues();
                    showStatus('ડેટા લોડ કરવામાં ભૂલ, ડિફૉલ્ટ મૂલ્યોનો ઉપયોગ કરી રહ્યા છીએ.', 'error');
                }
            } else {
                setDefaultValues();
                setTimeout(() => {
                    showStatus('કોઈ સંગ્રહિત ડેટા મળ્યો નથી (No saved data found).', 'error');
                }, 500);
            }
        }

        function setDefaultValues() {
            formInputs.firNumber.value = "અમીરગઢ પો.સ્ટે ગુ. ર.નં. ૧૧૧૯/૨૦૨૫";
            formInputs.year.value = "૨૦૨૫";
            formInputs.accusedName.value = "કાન્તીભાઇ બાબુભાઇ જાતે ઘોરણા";
            formInputs.surname.value = "ઘોરણા";
            formInputs.fatherName.value = "બાબુભાઇ";
            formInputs.caste.value = "હિંદુ ઘોરણા";
            formInputs.district.value = "બનાસકાંઠા";
            formInputs.taluka.value = "અમીરગઢ";
            formInputs.village.value = "વેરા";
            formInputs.occupation.value = "ખેડૂત";
            formInputs.lawSection.value = "BNS કલમ ૨૮૧ મુજબ";
            formInputs.physicalDescription.value = "શરીરે જોતા મધ્યમબાંધાના રંગે શ્યામ વણા જેના ડાબા ગાલ પર જુનુ વાગેલાનુ નિશાન છે ઉંચાઇ ૧૬૫ સે.મી.";
            formInputs.uv.value = "૨૨";
            formInputs.height.value = "૧૬૫";
            formInputs.arrestStatus.value = "અટક";
            formInputs.crimeStatus.value = "-";
            formInputs.relativeInfo.value = "-";
            formInputs.diaryEntry.value = "સ્ટે.ડા.એ.નં. ૫૦૦૩૨૫૦/૨૦૨૫ ક./તા. ૨૧/૧૨/૨૦૨૫";
            formInputs.remarks.value = "આજરોજ તા. ૨૧/૧૨/૨૦૨૫ ના ક. ૧/૫/૩૦ વાગે નામદાર સુપ્રીમ કોર્ટની ગાઇડલાઇન મુજબ નોટીસ આપી જામીન મુક્ત કરેલ છે.";
            formInputs.officerName.value = "";
            formInputs.officerPost.value = "હેડ કોન્સ્ટેબલ";
            formInputs.policeStation.value = "અમીરગઢ પોલીસ સ્ટેશન";
            
            selectedDistrict = gujaratData.districts.find(d => d.district === "બનાસકાંઠા");
            currentTalukas = selectedDistrict ? selectedDistrict.talukas : [];
        }

        // Initialize dropdowns with district data
        function initializeDistrictDropdown() {
            districtOptions.innerHTML = '';
            
            // Add options for each district
            gujaratData.districts.forEach(district => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = district.district;
                option.dataset.english = district.name_en;
                option.dataset.gujarati = district.district;
                
                option.addEventListener('click', () => {
                    formInputs.district.value = district.district;
                    selectedDistrict = district;
                    currentTalukas = district.talukas;
                    updateTalukaDropdown();
                    districtOptions.style.display = 'none';
                    updatePreview();
                });
                
                districtOptions.appendChild(option);
            });
            
            // Show/hide dropdown on focus
            formInputs.district.addEventListener('focus', () => {
                districtOptions.style.display = 'block';
            });
            
            formInputs.district.addEventListener('blur', () => {
                setTimeout(() => {
                    districtOptions.style.display = 'none';
                }, 200);
            });
            
            // Filter options as user types
            formInputs.district.addEventListener('input', () => {
                const searchTerm = formInputs.district.value.toLowerCase();
                const options = districtOptions.querySelectorAll('.dropdown-option');
                
                options.forEach(option => {
                    const gujaratiText = option.dataset.gujarati.toLowerCase();
                    const englishText = option.dataset.english.toLowerCase();
                    
                    if (gujaratiText.includes(searchTerm) || englishText.includes(searchTerm)) {
                        option.style.display = 'block';
                    } else {
                        option.style.display = 'none';
                    }
                });
                
                // Auto-translate if English is typed
                if (searchTerm.length > 2) {
                    const translated = translateToGujarati(searchTerm);
                    if (translated !== searchTerm) {
                        const foundDistrict = gujaratData.districts.find(d => 
                            d.district === translated || d.name_en.toLowerCase() === searchTerm
                        );
                        
                        if (foundDistrict) {
                            selectedDistrict = foundDistrict;
                            currentTalukas = foundDistrict.talukas;
                            updateTalukaDropdown();
                        }
                    }
                }
                
                districtOptions.style.display = 'block';
                updatePreview();
            });
        }

        // Initialize taluka dropdown
        function initializeTalukaDropdown() {
            formInputs.taluka.addEventListener('focus', () => {
                if (selectedDistrict) {
                    talukaOptions.style.display = 'block';
                }
            });
            
            formInputs.taluka.addEventListener('blur', () => {
                setTimeout(() => {
                    talukaOptions.style.display = 'none';
                }, 200);
            });
            
            formInputs.taluka.addEventListener('input', () => {
                if (selectedDistrict) {
                    const searchTerm = formInputs.taluka.value.toLowerCase();
                    const options = talukaOptions.querySelectorAll('.dropdown-option');
                    
                    options.forEach(option => {
                        const text = option.textContent.toLowerCase();
                        if (text.includes(searchTerm)) {
                            option.style.display = 'block';
                        } else {
                            option.style.display = 'none';
                        }
                    });
                    
                    talukaOptions.style.display = 'block';
                }
                updatePreview();
            });
        }

        // Update taluka dropdown based on selected district
        function updateTalukaDropdown() {
            talukaOptions.innerHTML = '';
            
            if (!selectedDistrict) return;
            
            currentTalukas.forEach(taluka => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = taluka;
                
                option.addEventListener('click', () => {
                    formInputs.taluka.value = taluka;
                    talukaOptions.style.display = 'none';
                    updatePreview();
                });
                
                talukaOptions.appendChild(option);
            });
        }

        // English to Gujarati translation
        function translateToGujarati(text) {
            if (!text || typeof text !== 'string') return text;
            
            const lowerText = text.toLowerCase().trim();
            
            // Check for exact matches in translation map
            for (const [english, gujarati] of Object.entries(translationMap)) {
                if (lowerText === english) {
                    return gujarati;
                }
            }
            
            // Check for district names
            for (const district of gujaratData.districts) {
                if (district.name_en.toLowerCase() === lowerText) {
                    return district.district;
                }
            }
            
            // Return original text if no translation found
            return text;
        }

        // Format date to Gujarati DD/MM/YYYY format
        function formatDate(dateStr) {
            if (!dateStr) return "";
            const date = new Date(dateStr);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Update live preview with exact table format from image
        function updatePreview() {
            // Get current values
            const firNum = formInputs.firNumber.value || "";
            const accusedFullName = `${formInputs.accusedName.value}, ${formInputs.fatherName.value} ${formInputs.surname.value}`;
            const address = `રહે. ${formInputs.village.value}, તા.${formInputs.taluka.value}, જી.${formInputs.district.value}`;
            const casteLine = formInputs.caste.value;
            const occupationLine = formInputs.occupation.value ? `<br>${formInputs.occupation.value}` : '';
            const uvValue = formInputs.uv.value || "";
            const heightValue = formInputs.height.value || "";
            
            // Generate the document preview HTML - EXACT format from image
            documentPreview.innerHTML = `
                <div style="text-align: center; margin-bottom: 12px; font-size: 11px; line-height: 1.4;">
                    મોજે- ${formInputs.village.value}
                    તા.- ${formInputs.taluka.value}
                    જીલ્લો- ${formInputs.district.value}
                    ના પોલીસ થાણાનાં અધિકારીની હદમાં પકડેલા ઈસમનુ ચહેરાનિશાન પત્રક
                </div>
                
                <table class="document-table">
                    <thead>
                        <tr>
                            <th>અ નં</th>
                            <th>ગુન્હા રજી. નંબર</th>
                            <th>પકડેલા માણસનું નામ તથા બાપનું નામ તથા અટક</th>
                            <th>રહેવાનુ ઠેકાણું ગામ, તાલુકો, જીલ્લો</th>
                            <th>જાતી અને ધંધો</th>
                            <th>ગુન્હો (તહોમત)</th>
                            <th>શરીર પરની નીશાનીઓ</th>
                            <th>અટકાય તમાં છે કે જામીન ઉપર છે</th>
                            <th>ગુન્‍હો સાબીત થયો કે ના સાબીત થયો કે છોડી મુકયા</th>
                            <th>આરોપીઓના સગા સબંધીને જાણ કરેલ હોય તો તેનુ નામ,સરનામું</th>
                            <th>જાણ કર્યાની રીતે સમયતા તથા આ સબબ દૈનિક સ્‍ટે.ડા.માં એન્‍ટ્રીનાં કરેલ ક્રમાંક તથા સમય</th>
                            <th>શેરો</th>
                        </tr>
                        <tr>
                            <th>(૧)</th>
                            <th>(૨)</th>
                            <th>(૩)</th>
                            <th>(૪)</th>
                            <th>(૫)</th>
                            <th>(૬)</th>
                            <th>(૭)</th>
                            <th>(૮)</th>
                            <th>(૯)</th>
                            <th>(૧૦)</th>
                            <th>(૧૧)</th>
                            <th>(૧૨)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="serial-number">૧</td>
                            <td>${firNum}</td>
                            <td>${accusedFullName}</td>
                            <td>${address}</td>
                            <td>${casteLine}<br><span style="text-decoration: underline;">ધંધો</span>${occupationLine}</td>
                            <td>${formInputs.lawSection.value}</td>
                            <td style="text-align: left;">${formInputs.physicalDescription.value}<br><span style="text-decoration: underline;">ઉ.વ.</span>&nbsp;&nbsp;&nbsp;<span style="text-decoration: underline;">ઉંચાઇ</span><br>${uvValue}&nbsp;&nbsp;&nbsp;${heightValue}</td>
                            <td>${formInputs.arrestStatus.value}</td>
                            <td>${formInputs.crimeStatus.value}</td>
                            <td>${formInputs.relativeInfo.value}</td>
                            <td>${formInputs.diaryEntry.value}</td>
                            <td style="text-align: left;">${formInputs.remarks.value}<br><br>(${formInputs.officerName.value})<br>${formInputs.officerPost.value}<br>${formInputs.policeStation.value}</td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        // Generate PDF
        async function generatePDF() {
            showStatus('PDF જનરેશન શરૂ કરી રહ્યા છીએ...', 'success');
            
            try {
                // Create a new jsPDF instance with proper settings
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Page metrics and margins
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 10; // mm
                
                // Define table columns
                const headers = [
                    ["અ નં", "ગુન્હા રજી. નંબર", "પકડેલા માણસનું નામ, તેના બાપનુ નામ તથા તેની અટક", 
                     "રહેવાનુ હેકાણું (ગામ, તાલુકો અને જીલ્લો)", "જાતી અને ધંધો", "ગુન્હો તહોમત",
                     "શરીર પરની નીશાનીઓ", "અટકાય તમાં છે કે જામીન ઉપર છે", 
                     "ગુન્હો સાબીત થયો કે નાસાબીત થયો કે છોડી મુકયા",
                     "આરોપીઓના સગા સબંધીને જાણ કરેલ હોય તો તેનુ નામ,સરનામું",
                     "જાણ કયાર્ની રીતે સમયતા તથા આ સબબ દૈનિક સ્ટે.ડા.માં એન્ટ્રીનાં કરેલ કમાંક તથા સમય",
                     "શેરો"]
                ];
                
                // Prepare data
                const address = `${formInputs.village.value}, તા.${formInputs.taluka.value}, જી.${formInputs.district.value}`;
                const casteOccupation = `${formInputs.caste.value}, ${formInputs.occupation.value}`;
                const accusedFullName = `${formInputs.accusedName.value}, ${formInputs.fatherName.value} ${formInputs.surname.value}`;
                
                const data = [
                    ["૧", 
                     formInputs.firNumber.value,
                     accusedFullName,
                     address,
                     casteOccupation,
                     formInputs.lawSection.value,
                     formInputs.physicalDescription.value,
                     formInputs.arrestStatus.value,
                     formInputs.crimeStatus.value,
                     formInputs.relativeInfo.value,
                     formInputs.diaryEntry.value,
                     formInputs.remarks.value.split('\n')[0] || formInputs.remarks.value
                    ]
                ];
                
                // Create table manually since autoTable doesn't support Gujarati well
                // We'll use html2canvas as fallback
                const canvas = await html2canvas(documentPreview, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                const imgData = canvas.toDataURL('image/png');
                const imgPixelWidth = canvas.width;
                const imgPixelHeight = canvas.height;

                // Compute scale to fit within margins
                const availableWidth = pageWidth - margin * 2;
                const availableHeight = pageHeight - margin * 2;
                const scale = Math.min(availableWidth / (imgPixelWidth / 96 * 25.4), availableHeight / (imgPixelHeight / 96 * 25.4));

                // Convert pixel dimensions to mm (assuming 96 DPI)
                const imgMmWidth = (imgPixelWidth / 96) * 25.4 * scale;
                const imgMmHeight = (imgPixelHeight / 96) * 25.4 * scale;

                pdf.addImage(imgData, 'PNG', margin, margin, imgMmWidth, imgMmHeight);
                
                // Save the PDF
                const fileName = `Arrest_Register_${formInputs.firNumber.value.replace(/\//g, '_') || 'Document'}.pdf`;
                pdf.save(fileName);
                
                showStatus('PDF સફળતાપૂર્વક જનરેટ થયો અને ડાઉનલોડ શરૂ થયો', 'success');
            } catch (error) {
                console.error('PDF generation error:', error);
                showStatus('PDF જનરેટ કરવામાં ભૂલ આવી છે. કૃપા કરીને ફરી પ્રયાસ કરો.', 'error');
            }
        }

        // Generate Word document
        async function generateDOCX() {
            showStatus('Word ડોક્યુમેન્ટ જનરેશન શરૂ કરી રહ્યા છીએ...', 'success');

            try {
                const {
                    Document,
                    Packer,
                    Paragraph,
                    TextRun,
                    Table,
                    TableRow,
                    TableCell,
                    AlignmentType,
                    WidthType,
                    BorderStyle,
                    UnderlineType,
                } = docx;

                // Helpers
                const mmToTwip = (mm) => Math.round(mm * 1440 / 25.4);

                // Header paragraphs (centered), mirroring preview
                const headerParagraphs = [
                    new Paragraph({
                        alignment: AlignmentType.CENTER,
                        children: [new TextRun({ text: `મોજે- ${formInputs.village.value}`, bold: true })],
                        spacing: { after: 40 },
                    }),
                    new Paragraph({
                        alignment: AlignmentType.CENTER,
                        children: [new TextRun({ text: `તા.- ${formInputs.taluka.value}`, bold: true })],
                        spacing: { after: 40 },
                    }),
                    new Paragraph({
                        alignment: AlignmentType.CENTER,
                        children: [new TextRun({ text: `જીલ્લો- ${formInputs.district.value}`, bold: true })],
                        spacing: { after: 120 },
                    }),
                    new Paragraph({
                        alignment: AlignmentType.CENTER,
                        children: [new TextRun({ text: 'ના પોલીસ થાણાનાં અધિકારીની હદમાં પકડેલા આરોપીઓનું અટક રેજિસ્ટર' })],
                        spacing: { after: 200 },
                    }),
                ];

                // Table column widths (percentages summing to 100)
                const colPercents = [4, 9, 11, 9, 7, 7, 9, 7, 7, 9, 11, 10];

                const makeHeaderCell = (text, widthPct) =>
                    new TableCell({
                        width: { size: widthPct, type: WidthType.PERCENTAGE },
                        children: [
                            new Paragraph({
                                alignment: AlignmentType.CENTER,
                                children: [new TextRun({ text, bold: true })],
                            }),
                        ],
                    });

                const makeNumberHeaderCell = (text, widthPct) =>
                    new TableCell({
                        width: { size: widthPct, type: WidthType.PERCENTAGE },
                        children: [
                            new Paragraph({
                                alignment: AlignmentType.CENTER,
                                children: [new TextRun({ text })],
                            }),
                        ],
                    });

                // Build header rows
                const headerTitles = [
                    'અ નં',
                    'ગુન્હા રજી. નંબર',
                    'પકડેલા માણસનું નામ તથા બાપનું નામ તથા અટક',
                    'રહેવાનુ ઠેકાણું ગામ, તાલુકો, જીલ્લો',
                    'જાતી અને ધંધો',
                    'ગુન્હો (તહોમત)',
                    'શરીર પરની નીશાનીઓ',
                    'અટકાયત માં છે કે જામીન પર',
                    'ગુન્હો સાબીત થયો છે કે કેમ?',
                    'પકડાયા બદલ સગા સબંધીને જાણ કરી હોય તો તેનુ નામ સરનામું',
                    'જાણ કર્યાની રીતે તારીખ સમય',
                    'શેરો',
                ];

                const headerNums = ['(૧)', '(૨)', '(૩)', '(૪)', '(૫)', '(૬)', '(૭)', '(૮)', '(૯)', '(૧૦)', '(૧૧)', '(૧૨)'];

                const headerRow1 = new TableRow({
                    children: headerTitles.map((t, i) => makeHeaderCell(t, colPercents[i])),
                });
                const headerRow2 = new TableRow({
                    children: headerNums.map((t, i) => makeNumberHeaderCell(t, colPercents[i])),
                });

                // Data row content, mirroring preview
                const firNum = formInputs.firNumber.value || '';
                const accusedFullName = `${formInputs.accusedName.value}, ${formInputs.fatherName.value} ${formInputs.surname.value}`;
                const address = `ગામ: ${formInputs.village.value}, તા.${formInputs.taluka.value}, જી.${formInputs.district.value}`;
                const casteLine = formInputs.caste.value || '';
                const occupationLine = formInputs.occupation.value || '';
                const uvValue = formInputs.uv.value || '';
                const heightValue = formInputs.height.value || '';

                const makeCell = (paragraphs, widthPct) =>
                    new TableCell({
                        width: { size: widthPct, type: WidthType.PERCENTAGE },
                        children: paragraphs,
                    });

                const dataRow = new TableRow({
                    children: [
                        // (1) Serial number
                        makeCell([
                            new Paragraph({
                                alignment: AlignmentType.CENTER,
                                children: [new TextRun({ text: '૧', bold: true })],
                            }),
                        ], colPercents[0]),

                        // (2) FIR number
                        makeCell([new Paragraph({ children: [new TextRun({ text: firNum })] })], colPercents[1]),

                        // (3) Accused name
                        makeCell([new Paragraph({ children: [new TextRun({ text: accusedFullName })] })], colPercents[2]),

                        // (4) Address
                        makeCell([new Paragraph({ children: [new TextRun({ text: address })] })], colPercents[3]),

                        // (5) Caste and Occupation (with underlined ધંધો)
                        makeCell([
                            new Paragraph({ children: [new TextRun({ text: casteLine })] }),
                            new Paragraph({
                                children: [
                                    new TextRun({ text: 'ધંધો', underline: UnderlineType.SINGLE }),
                                    ...(occupationLine ? [new TextRun({ text: `\n${occupationLine}` })] : []),
                                ],
                            }),
                        ], colPercents[4]),

                        // (6) Law section
                        makeCell([new Paragraph({ children: [new TextRun({ text: formInputs.lawSection.value })] })], colPercents[5]),

                        // (7) Physical description + underlined labels and values
                        makeCell([
                            new Paragraph({ children: [new TextRun({ text: formInputs.physicalDescription.value })] }),
                            new Paragraph({
                                children: [
                                    new TextRun({ text: 'ઉ.વ.', underline: UnderlineType.SINGLE }),
                                    new TextRun({ text: '   ' }),
                                    new TextRun({ text: 'ઉંચાઇ', underline: UnderlineType.SINGLE }),
                                ],
                            }),
                            new Paragraph({ children: [new TextRun({ text: `${uvValue}   ${heightValue}` })] }),
                        ], colPercents[6]),

                        // (8) Arrest status
                        makeCell([new Paragraph({ children: [new TextRun({ text: formInputs.arrestStatus.value })] })], colPercents[7]),

                        // (9) Crime status
                        makeCell([new Paragraph({ children: [new TextRun({ text: formInputs.crimeStatus.value })] })], colPercents[8]),

                        // (10) Relative info
                        makeCell([new Paragraph({ children: [new TextRun({ text: formInputs.relativeInfo.value })] })], colPercents[9]),

                        // (11) Diary entry
                        makeCell([new Paragraph({ children: [new TextRun({ text: formInputs.diaryEntry.value })] })], colPercents[10]),

                        // (12) Remarks + officer details
                        makeCell([
                            new Paragraph({ children: [new TextRun({ text: formInputs.remarks.value })] }),
                            new Paragraph({ children: [new TextRun({ text: `(${formInputs.officerName.value})` })] }),
                            new Paragraph({ children: [new TextRun({ text: formInputs.officerPost.value })] }),
                            new Paragraph({ children: [new TextRun({ text: formInputs.policeStation.value })] }),
                        ], colPercents[11]),
                    ],
                });

                // Build table with borders and percentage width
                const table = new Table({
                    width: { size: 100, type: WidthType.PERCENTAGE },
                    borders: {
                        top: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                        bottom: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                        left: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                        right: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                        insideHorizontal: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                        insideVertical: { style: BorderStyle.SINGLE, size: 4, color: '000000' },
                    },
                    rows: [headerRow1, headerRow2, dataRow],
                });

                const doc = new Document({
                    sections: [
                        {
                            properties: {
                                page: {
                                    margin: {
                                        top: mmToTwip(10),
                                        right: mmToTwip(10),
                                        bottom: mmToTwip(10),
                                        left: mmToTwip(10),
                                    },
                                    size: { orientation: 'landscape' },
                                },
                            },
                            children: [...headerParagraphs, table],
                        },
                    ],
                });

                const blob = await Packer.toBlob(doc);
                const fileName = `Arrest_Register_${formInputs.firNumber.value.replace(/\//g, '_') || 'Document'}.docx`;

                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showStatus('Word ડોક્યુમેન્ટ સફળતાપૂર્વક જનરેટ થયો અને ડાઉનલોડ શરૂ થયો', 'success');
            } catch (error) {
                console.error('DOCX generation error:', error);
                showStatus('Word ડોક્યુમેન્ટ જનરેટ કરવામાં ભૂલ આવી છે. કૃપા કરીને ફરી પ્રયત્ન કરો.', 'error');
            }
        }

        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message';
            statusMessage.classList.add(`status-${type}`);
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Reset form
        function resetForm() {
            if (confirm('શું તમે ખરેખર ફોર્મ રીસેટ કરવા માંગો છો? તમારી બધી દાખલ કરેલી માહિતી ખોવાઈ જશે.')) {
                initializeForm();
                updatePreview();
                showStatus('ફોર્મ સફળતાપૂર્વક રીસેટ કરવામાં આવ્યો છે', 'success');
            }
        }

        // Event Listeners
        function setupEventListeners() {
            // Update preview on any form input
            Object.values(formInputs).forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });
            
            // Generate PDF button
            generatePdfBtn.addEventListener('click', generatePDF);
            
            // Generate Word button
            generateDocxBtn.addEventListener('click', generateDOCX);
            
            // Reset form button
            resetFormBtn.addEventListener('click', resetForm);
            
            // Form validation
            const form = document.querySelector('.form-section');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                let valid = true;
                
                Object.values(formInputs).forEach(input => {
                    if (input.hasAttribute('required') && !input.value.trim()) {
                        valid = false;
                        input.style.borderColor = '#d32f2f';
                    } else {
                        input.style.borderColor = '#bdbdbd';
                    }
                });
                
                if (valid) {
                    showStatus('ફોર્મ માન્ય છે. PDF અથવા Word જનરેટ કરો.', 'success');
                } else {
                    showStatus('કૃપા કરીને બધા જરૂરી ક્ષેત્રો ભરો.', 'error');
                }
            });
        }

        // Initialize application
        function init() {
            initializeForm();
            initializeDistrictDropdown();
            initializeTalukaDropdown();
            setupEventListeners();
            updatePreview();
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>