<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart English to Gujarati Editor</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Gujarati:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f0fdf4; }
        .gujarati-font { font-family: 'Noto Sans Gujarati', sans-serif; line-height: 1.6; }
        
        /* Status Indicator Pulse */
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <!-- Header -->
    <div class="w-full max-w-5xl flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
                <span class="text-green-600">ગુજરાતી</span> Editor
            </h1>
            <p class="text-gray-500 text-sm mt-1">Type in English, get Gujarati. Fast & Private.</p>
        </div>
        
        <!-- Status Badge -->
        <div class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-semibold flex items-center gap-2 shadow-sm border border-green-200">
            <span class="status-dot bg-green-500 animate-pulse"></span>
            Smart Engine Active
        </div>
    </div>

    <!-- Main Editor Container -->
    <div class="bg-white w-full max-w-5xl rounded-2xl shadow-xl overflow-hidden border border-gray-100 flex flex-col md:flex-row h-[75vh]">
        
        <!-- SIDE A: Source / Logic Controls -->
        <div class="w-full md:w-1/3 bg-gray-50 border-r border-gray-200 p-6 flex flex-col gap-4">
            
            <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl">
                <h3 class="font-bold text-blue-800 mb-2">How it works</h3>
                <p class="text-sm text-blue-600 mb-2">
                    ✅ <strong>Phonetic Typing:</strong>
                    <br>• Type naturally: "kem cho" -> "કેમ છો"
                    <br>• Smart clusters: "tr" -> "ત્ર", "st" -> "સ્ત"
                    <br>• Use the box below to type.
                </p>
            </div>

            <!-- Phonetic Input Box -->
            <div class="flex-1 flex flex-col">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Type English Here</label>
                <textarea id="phoneticInput" class="w-full h-full p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-green-400 outline-none resize-none text-gray-700 text-lg" placeholder="e.g. 'namaste' -> 'નમસ્તે'"></textarea>
            </div>

            <div class="mt-auto pt-4">
                <button onclick="clearAll()" class="w-full py-2.5 rounded-lg text-red-600 hover:bg-red-50 font-medium transition-colors">Clear Text</button>
            </div>
        </div>

        <!-- SIDE B: The Main Gujarati Editor -->
        <div class="w-full md:w-2/3 flex flex-col relative bg-white">
            <!-- Toolbar -->
            <div class="p-3 border-b border-gray-100 flex justify-between items-center bg-white sticky top-0 z-10">
                <span class="text-xs font-bold text-gray-400 uppercase tracking-wider ml-2">Final Output (Editable)</span>
                <div class="flex gap-2">
                    <button onclick="copyText()" class="flex items-center gap-2 px-4 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-medium shadow-md transition-all">
                        Copy
                    </button>
                </div>
            </div>

            <!-- The Magic Textarea -->
            <textarea 
                id="mainEditor" 
                class="gujarati-font w-full flex-1 p-6 text-2xl text-gray-800 focus:outline-none resize-none placeholder-gray-300"
                placeholder="Translation appears here..."></textarea>
                
            <!-- Notification Toast -->
            <div id="toast" class="absolute bottom-6 right-6 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg text-sm opacity-0 transition-opacity duration-300 pointer-events-none">
                Action Completed
            </div>
        </div>
    </div>

    <script>
        // --- VARIABLES ---
        const mainEditor = document.getElementById('mainEditor');
        const phoneticInput = document.getElementById('phoneticInput');

        // --- ENGINE CONFIGURATION ---
        
        const vowels = {
            'aa': 'આ', 'a': 'અ', 'i': 'ઇ', 'ee': 'ઈ', 'u': 'ઉ', 'oo': 'ઊ', 
            'ru': 'ઋ', 'e': 'એ', 'ai': 'ઐ', 'o': 'ઓ', 'au': 'ઔ', 'am': 'અં', 'ah': 'અઃ'
        };

        const matras = {
            'aa': 'ા', 'a': '', 'i': 'િ', 'ee': 'ી', 'u': 'ુ', 'oo': 'ૂ', 
            'ru': 'ૃ', 'e': 'ે', 'ai': 'ૈ', 'o': 'ો', 'au': 'ૌ', 'am': 'ં', 'ah': 'ઃ'
        };

        const consonants = {
            // Basic Consonants
            'k': 'ક', 'kh': 'ખ', 'g': 'ગ', 'gh': 'ઘ', 'ng': 'ઙ',
            'ch': 'ચ', 'chh': 'છ', 'j': 'જ', 'z': 'ઝ', 'jh': 'ઝ', 'ny': 'ઞ',
            'T': 'ટ', 'Th': 'ઠ', 'D': 'ડ', 'Dh': 'ઢ', 'N': 'ણ',
            't': 'ત', 'th': 'થ', 'd': 'દ', 'dh': 'ધ', 'n': 'ન',
            'p': 'પ', 'ph': 'ફ', 'f': 'ફ', 'b': 'બ', 'bh': 'ભ', 'm': 'મ',
            'y': 'ય', 'r': 'ર', 'l': 'લ', 'v': 'વ', 'w': 'વ',
            'sh': 'શ', 'Sh': 'ષ', 's': 'સ', 'h': 'હ', 'L': 'ળ', 'x': 'ક્ષ',

            // Special Conjuncts (Smart Logic)
            'ksh': 'ક્ષ', 'gn': 'જ્ઞ', 'tr': 'ત્ર', 'dr': 'દ્ર', 'pr': 'પ્ર',
            'kr': 'ક્ર', 'gr': 'ગ્ર', 'br': 'બ્ર', 'mr': 'મ્ર',
            'st': 'સ્ત', 'sp': 'સ્પ', 'sw': 'સ્વ', 'sn': 'સ્ન', 'sm': 'સ્મ',
            'sk': 'સ્ક', 'sl': 'સ્લ',
            'kt': 'ક્ત', 'tt': 'ત્ત', 'dd': 'દ્દ', 'mm': 'મ્મ', 'nn': 'ન્ન',
            'hy': 'હ્ય', 'dy': 'દ્ય', 'ry': 'ર્ય', 'jy': 'જ્ય', 'ty': 'ત્ય', 'ny': 'ન્ય',
            'shr': 'શ્ર', 'shw': 'શ્વ', 'shy': 'શ્ય'
        };

        const others = {
            'OM': 'ૐ', '.': '।', 'rs': '₹', '//': '॥'
        };

        // --- TRANSLITERATION LOGIC ---

        function manualTransliterate(word) {
            let result = "";
            let i = 0;
            
            // Optimization: Pre-sort keys by length only once? 
            // For simplicity in this file, we sort on every call or rely on definition order if engine preserves it. 
            // JS engines mostly preserve definition order for strings, but explicit sort is safer for 'tr' vs 't'.
            const sortedConsonants = Object.keys(consonants).sort((a,b) => b.length - a.length);
            const sortedVowels = Object.keys(vowels).sort((a,b) => b.length - a.length);
            const sortedMatras = Object.keys(matras).sort((a,b) => b.length - a.length);

            while (i < word.length) {
                let match = false;

                // 1. Check Consonants (including conjuncts like 'tr', 'st')
                for (let key of sortedConsonants) {
                    if (word.substr(i).startsWith(key)) {
                        let char = consonants[key];
                        i += key.length;
                        
                        // Look for Matra (Vowel attachment)
                        let matraFound = false;
                        for (let mKey of sortedMatras) {
                            if (word.substr(i).startsWith(mKey)) {
                                result += char + matras[mKey];
                                i += mKey.length;
                                matraFound = true;
                                break;
                            }
                        }

                        // If no matra, just append the consonant (Implicit 'a')
                        // Note: To type half letters explicitly not covered by conjuncts, 
                        // one would usually need a 'virama' mapping (e.g. mapped to '`' or similar), 
                        // but our conjunct list covers common cases like 'st'.
                        if (!matraFound) {
                            result += char;
                        }
                        
                        match = true;
                        break;
                    }
                }

                if (match) continue;

                // 2. Check Independent Vowels (if not preceded by consonant)
                for (let key of sortedVowels) {
                    if (word.substr(i).startsWith(key)) {
                        result += vowels[key];
                        i += key.length;
                        match = true;
                        break;
                    }
                }

                if (match) continue;

                // 3. Special Symbols
                if (others[word.substr(i, 2)]) {
                    result += others[word.substr(i, 2)];
                    i += 2;
                    continue;
                }
                if (others[word[i]]) {
                    result += others[word[i]];
                    i++;
                    continue;
                }

                // 4. Fallback (Numbers, Punctuation)
                result += word[i];
                i++;
            }
            return result;
        }

        function translateWholeText(text) {
            // Split by separators but keep them to preserve formatting
            return text.split(/([ \n\t.,!?]+)/).map(token => {
                // Only transliterate if it looks like an English word
                if (token.match(/^[a-zA-Z]+$/)) {
                    return manualTransliterate(token);
                }
                return token;
            }).join('');
        }

        // --- EVENT LISTENERS ---

        phoneticInput.addEventListener('input', (e) => {
            const converted = translateWholeText(e.target.value);
            mainEditor.value = converted;
        });

        function clearAll() {
            mainEditor.value = '';
            phoneticInput.value = '';
            phoneticInput.focus();
            showToast("Cleared");
        }

        function copyText() {
            mainEditor.select();
            document.execCommand("copy");
            window.getSelection().removeAllRanges();
            showToast("Gujarati Copied! ✅");
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 2000);
        }
        
        // Focus input on load
        phoneticInput.focus();

    </script>
</body>
</html>